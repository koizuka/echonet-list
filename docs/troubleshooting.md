# トラブルシューティングガイド

このドキュメントでは、ECHONET Lite Device Discovery and Control Toolを使用する際に発生する可能性のある一般的な問題とその解決方法について説明します。

## 一般的なエラー

### ポートが既に使用中

エラーメッセージ：

```text
listen udp :3610: bind: address already in use
```

このエラーは、UDPポート3610が既に他のプロセスによって使用されていることを示します。

**解決方法：**

1. 他の実行中のインスタンスを探して終了
   - Linux/macOS: `ps aux | grep echonet-list` でプロセスを探し、`kill <PID>` で終了
   - Windows: タスクマネージャーを使用してプロセスを終了
2. 他のインスタンスを停止した後、アプリケーションを再起動

### デバイスが検出されない

**考えられる原因：**

1. デバイスが電源オフまたはネットワークから切断
2. ファイアウォールがUDPポート3610をブロック
3. デバイスが別のサブネットにある

**解決方法：**

1. デバイスの電源とネットワーク接続を確認
2. ファイアウォールの設定を確認し、必要に応じてUDPポート3610を開放
3. デバイスが同じサブネットにあることを確認

### WebSocket接続エラー

**考えられる原因：**

1. WebSocketサーバーが起動していない
2. ポートが既に使用中
3. TLS証明書の問題

**解決方法：**

1. WebSocketサーバーが有効になっていることを確認
2. 使用中のポートを確認し、必要に応じて別のポートを指定
3. TLS証明書が正しく設定されていることを確認

## デバッグモードの使用

問題の診断には、デバッグモードが役立ちます：

```bash
# デバッグモードを有効にして起動
./echonet-list -debug

# または、実行中にデバッグモードを切り替え
> debug on
```

デバッグモードでは以下の情報が表示されます：

- パケットの詳細な内容
- 16進数ダンプ
- 通信のタイミング情報
- エラーの詳細な情報

## ログファイルの確認

アプリケーションは `echonet-list.log` にログを記録します。問題が発生した場合は、このログファイルを確認してください：

```bash
# ログファイルの最後の100行を表示
tail -n 100 echonet-list.log

# エラーを含む行を表示
grep -i error echonet-list.log
```

## WebSocket関連の問題

### 接続が切断される

**考えられる原因：**

1. ネットワークの不安定さ
2. タイムアウト設定
3. サーバーの再起動

**解決方法：**

1. ネットワーク接続を確認
2. クライアント側で再接続ロジックを実装
3. サーバーの状態を確認

### TLS証明書の警告

**考えられる原因：**

1. 自己署名証明書の使用
2. 証明書の期限切れ
3. 証明書の設定ミス

**解決方法：**

1. 開発環境では `mkcert` を使用して証明書を生成
2. 証明書の有効期限を確認
3. 証明書の設定を確認

## パフォーマンスの問題

### 応答が遅い

**考えられる原因：**

1. ネットワークの遅延
2. デバイスの応答が遅い
3. 同時に多数のリクエストを送信

**解決方法：**

1. ネットワークの状態を確認
2. デバイスの状態を確認
3. リクエストの頻度を調整

### メモリ使用量が高い

**考えられる原因：**

1. 多数のデバイスを監視
2. ログファイルが大きい
3. メモリリーク

**解決方法：**

1. 監視するデバイスの数を制限
2. ログローテーションを設定
3. アプリケーションを再起動

## 参考資料

- [エラーハンドリングガイド](error_handling_guide.md)
- [WebSocket Client Protocol](websocket_client_protocol.md)
- [mkcert Setup Guide](mkcert_setup_guide.md)
