# Progress

This file tracks the implementation progress of the project features defined in [projectbrief.md](./projectbrief.md) and planned in [activeContext.md](./activeContext.md).

## What Works

- ECHONET Lite デバイスの検出と制御
- エイリアス機能（作成、表示、削除、一覧表示、永続化）
- メッセージ再送信機能（タイムアウト時に最大3回再試行）
- ヘルプコマンドの拡張（コマンド名指定で詳細表示）
- WebSocketサーバーとクライアント実装
  - TLS対応
  - 設定ファイルサポート
  - 通知機能（デバイス追加、タイムアウト、プロパティ変更）
- デバイスグループ管理機能
  - グループの作成、表示、削除、一覧表示
  - `@`プレフィックスによるグループ指定
  - グループ内の全デバイスに対する一括操作
- `devices`コマンドのグループ化機能（`-group-by <epc>`オプション）
- WebSocketサーバーの定期的なプロパティ自動更新機能（クライアント接続時、設定ファイルで指定可能な間隔、デフォルト1分）
- デバイスのオフライン状態管理（タイムアウト時に自動マーク、`UpdateProperties` でのスキップ）

## What's Left to Build

- **デバイスのオフライン状態管理**:
  - 実装済み: タイムアウト時に自動マーク、`UpdateProperties` でのスキップ
  - 実装予定: オフライン状態のコマンド/通知/UIへの反映、復帰条件の定義と実装
  - 状態: 基本機能実装済み、詳細な挙動定義と実装が必要
- **WebSocketクライアントの機能改善**: コンソールUI（WebSocketクライアント）のコマンド実装とテスト、オフライン状態対応
  - 実装予定: `discover`, `get`, `set`, `update`, `alias`, `group` コマンドのWebSocket経由での実装、テスト追加、オフライン状態ハンドリング
  - 状態: 一部実装済み、残りのコマンド実装とテストが必要
- **Web UI開発**: デバイスのオフライン状態管理機能の実装後、Web UIの開発に着手します。
  - **アーキテクチャ:** WebSocketサーバーと通信するSPAとして実装。Goアプリケーション内のHTTPサーバーから静的ファイルを配信します。詳細は `systemPatterns.md` を参照。
  - **フロントエンド技術:** React, Vue, Svelteなどのフレームワークを検討。試行錯誤のしやすさを重視します。詳細は `techContext.md` を参照。
  - **開発ワークフロー:** `webui/` ディレクトリで開発・ビルドし、成果物をサーバーの `http_webroot` に配置。開発中はサーバー再起動で更新。将来的にはConsole UIコマンドでのサーバー側リロードと、WebSocket通知によるクライアント側自動リロードを検討。詳細は `techContext.md` および `activeContext.md` を参照。
  - **機能要件:** デバイス一覧（設置場所グルーピング、状態可視化）、設置場所管理、グループ操作（既存API利用）、リアルタイム更新、オフライン状態表示。詳細は `productContext.md` を参照。
  - **状態:** 未着手（オフライン状態管理機能の実装後に開始）

**注記:** 当初の計画にあった「アーキテクチャ分割（CLIクライアントの分離）」は、現時点では優先度を下げ、実装を省略します。

## Completed Features

- ✅ **デバイス通知機能**: デバイスの追加通知とタイムアウト通知の実装
- ✅ **プロパティ変化通知機能**: デバイスのプロパティ値変化をリアルタイム通知
- ✅ **WebSocketサーバーのリファクタリング**: テスト可能な構造への改善
- ✅ **WebSocketプロトコルのクライアント開発者向けドキュメント**: 詳細な仕様と実装例の提供
- ✅ **WebSocketサーバーのTLS対応**: 安全な接続（WSS）のサポート
- ✅ **設定ファイルのサポート**: TOML形式の設定ファイル対応
- ✅ **デバイスグループ管理機能**: グループ作成と一括操作の実装
- ✅ **Devices Command Grouping Enhancement**: EPCの値でデバイスをグループ化表示
- ✅ **デバイスプロパティ更新タイムスタンプ機能**: デバイスごとにプロパティが最後に更新された時刻を記録し、WebSocketプロトコルを通じてクライアントに提供
- ✅ **WebSocketサーバーの定期的なプロパティ自動更新機能**: クライアント接続時に設定ファイルで指定可能な間隔（デフォルト1分）でプロパティを自動更新
- ✅ **デバイスオフライン状態管理 (基本)**: タイムアウト時の自動マークと `UpdateProperties` でのスキップ
