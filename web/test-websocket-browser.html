<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Debug Test</title>
</head>
<body>
    <h1>WebSocket Connection Test</h1>
    <div id="log"></div>
    
    <script>
        const log = document.getElementById('log');
        
        function addLog(message, type = 'info') {
            const div = document.createElement('div');
            div.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(div);
        }
        
        addLog('WebSocketÊé•Á∂ö„ÉÜ„Çπ„Éà„ÇíÈñãÂßã...');
        
        const ws = new WebSocket('wss://localhost:8080/ws');
        
        ws.onopen = (event) => {
            addLog('‚úÖ WebSocketÊé•Á∂öÊàêÂäü!', 'success');
            addLog(`ReadyState: ${ws.readyState}`);
            addLog(`Protocol: ${ws.protocol}`);
            addLog(`Extensions: ${ws.extensions}`);
        };
        
        ws.onmessage = (event) => {
            addLog(`üì® „É°„ÉÉ„Çª„Éº„Ç∏Âèó‰ø°: ${event.data.substring(0, 100)}...`);
        };
        
        ws.onerror = (event) => {
            addLog('‚ùå WebSocket„Ç®„É©„Éº', 'error');
            addLog(`Error type: ${event.type}`, 'error');
            addLog(`ReadyState: ${ws.readyState}`, 'error');
        };
        
        ws.onclose = (event) => {
            addLog(`üîå Êé•Á∂öÁµÇ‰∫Ü: code=${event.code}, reason="${event.reason}", wasClean=${event.wasClean}`, 'error');
            
            // Ë©≥Á¥∞„Å™„Ç®„É©„Éº„Ç≥„Éº„ÉâË™¨Êòé
            const codeDesc = {
                1000: 'Normal Closure',
                1001: 'Going Away',
                1002: 'Protocol Error',
                1003: 'Unsupported Data',
                1006: 'Abnormal Closure („Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÄÅSSLÂïèÈ°åÁ≠â)',
                1007: 'Invalid frame payload data',
                1008: 'Policy Violation',
                1009: 'Message Too Big',
                1011: 'Internal Server Error'
            };
            
            addLog(`„Ç®„É©„ÉºË©≥Á¥∞: ${codeDesc[event.code] || '‰∏çÊòé„Å™„Ç®„É©„Éº'}`, 'error');
        };
        
        // 5ÁßíÂæå„Å´„Çø„Ç§„É†„Ç¢„Ç¶„Éà
        setTimeout(() => {
            if (ws.readyState === WebSocket.CONNECTING) {
                addLog('‚è∞ Êé•Á∂ö„Çø„Ç§„É†„Ç¢„Ç¶„Éà', 'error');
                ws.close();
            }
        }, 5000);
    </script>
</body>
</html>